# 2.7 URI Query 디자인

## 목차

- [참고자료](#참고자료)
- [URI Query 의 개념](#uri-query-의-개념)
- [규칙 : URI 쿼리 부분으로 컬렉션이나 스토어를 필터링할 수 있다.](#규칙-uri-쿼리-부분으로-컬렉션이나-스토어를-필터링할-수-있다)
- [규칙 : URI 쿼리는 컬렉션이나 스토어의 결과를 페이지로 구분하여 나타내는데 사용해야 한다.](#규칙-uri-쿼리는-컬렉션이나-스토어의-결과를-페이지로-구분하여-나타내는데-사용해야-한다)

  

## 참고자료

[일관성 있는 웹 서비스 인터페이스 설계를 위한 REST API 디자인 규칙](www.yes24.com/Product/Goods/17945500)  

  

## URI Query 의 개념

RFC 3986 에서 URI 쿼리는 선택사항이다.  

URI 쿼리는 경로와 다른 선택사항인 프래그먼트(`#으로 표시되는 항목`)사이에 온다.

> URI = scheme "://" authority "/" path [ "?" query ] ["#" fragment]

  

URI 구성요소인 쿼리는 유일한 리소스를 식별하는 데에 도움을 준다. 아래의 예를 보자.

- http://api.college.restapi.org/students/morgan/send-sms
- http://api.college.restapi.org/students/morgan/send-sms?text=hello

  

**Query String? Query Param?**  

쿼리의 경우 웹 상에서 이래 저래 자료를 찾다보면 Query String 또는 Query Param 이라는 용어로도 부르는 것을 확인 할 수 있다. 이 쿼리라는 것은 REST API 클라이언트에는 반드시 필요한 사항은 아니다.  

  

**HTTP 캐시에서 쿼리가 인식되는지 여부**

URI의 쿼리 유무에 따라 캐시의 작용이나 기능이 바뀌어서는 안된다. 특히 요청 URI에 쿼리가 있다고 해서 응답메시지가 캐시에서 제외되어서는 안된다. 4장에서 자세히 정리하게 될 내용인데, 쿼리가 아닌 **HTTP 헤더가 캐시의 중간 역할을 결정**해야 한다.



## 규칙 : URI 쿼리 부분으로 컬렉션이나 스토어를 필터링할 수 있다.

URI 쿼리는 컬렉션, 스토어를 검색하는 기준으로 사용할 수 있다. 아래는 URI 쿼리를 스토어/컬렉션을 검색하는 조건으로 사용한 예이다.  

- GET /users?role=admin

  

## 규칙 : URI 쿼리는 컬렉션이나 스토어의 결과를 페이지로 구분하여 나타내는데 사용해야 한다.

REST API 클라이언트는 URI 쿼리를 통해 컬렉션 또는 스토어의 결과를 pageSize, pageStartIndex 와 같은 파라미터 값으로 페이지 처리 할 수 있다.  

예를 들면 pageSize, pageStartIndex 파라미터의 의미는 DB또는 스토어에서 가져오는 데이터를 pageSize 단위로 나누었을 때 몇번째 페이지(pageStartIndex) 결과를 가져올 지를 표현하는 것을 의미한다.  

예를 들면 아래와 같은 표현식을 예로 들 수 있다.  

>GET /users?pageSize=25&pageStartIndex=50
>
>- 이 URI 표현식의 의미는 이렇다. "**users 데이터를 가져오는데, 가져올 때 전체 데이터를 25 단위로 나누었을때 50번째 페이지를 가져오겠다.**"는 의미이다.

  

**페이지 또는 필터링을 사용할 수 없는 개발환경이라면**  

이런 경우 컬렉션 또는 스토어의 파트너가 될 수 있는 특별한 컨트롤러를 사용하는 것을 고려해야 한다.  

아래와 같은 URI를 컨트롤러로 사용했을 때의 예를 들어 보자.

> POST /users/search

이 경우 URI 쿼리 대신 POST 요청의 request body 로 요청을 전달할 수 있다. 이렇게 하면 정렬 기준, 검색조건, 페이징 요건 등을 request body 로 전달할 수 있게 된다.  

  

컨트롤러의 캐시 결과값은 표시하는 것에 주의를 기울여야 하는데, 여기에 대해서는 4장에서 정리하게 될 예정이다.

  