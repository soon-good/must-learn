# 2.5 리소스 원형

도큐먼트, 스토어, 컬렉션 이라는 용어는 REST API 를 이야기할 때 자주 언급되는 용어이다. 직관적으로 듣기에는 아는 내용처럼 느껴지기도 하고, 몽고 DB를 쓰면서 많이 접해본 단어들이다. 하지만, REST API 에서는 어떤 개념으로 쓰이는 단어인지 짚어보고 넘어가는 것이 중요할 것이라는 생각이 들었다.  

항상 뭔가 접할때 다 아는 것 같다고 감으로 짐작하고 넘어갈 때 2% 부족한 개념으로 남아버린다는 것을 깨달았다. 시간이 조금 더 들긴 하지만, 한번 볼때 제대로 정리하고 넘어가는 게 나을 것 같다는 생각이 들었다.



## 목차

- [참고자료](#참고자료)
- [도큐먼트](#도큐먼트)
- [컬렉션](#컬렉션)
- [스토어](#스토어)
- [컨트롤러](#컨트롤러)



## 참고자료

[일관성 있는 웹 서비스 인터페이스 설계를 위한 REST API 디자인 규칙](www.yes24.com/Product/Goods/17945500)  



## 도큐먼트

도큐먼트 리소스는 객체 인스턴스 또는 데이터베이스의 레코드와 유사한 단일 데이터 개념이다. 아래의 예제들은 모두 도큐먼트를 의미하는 리소스의 표현이다.

- http://api.soccer.restapi.org/leagues/seatle
- http://api.soccer.restapi.org/leagues/seatle/teams/trebuchet
- http://api.soccer.restapi.org/leagues/seatle/teams/trebuchet/players/mike

위 예제에서 보듯이 도큐먼트는 자식리소스를 가질 수 있다. 자식 리소스는 다른 곳에 종속되는 관계임을 표현한다.  

> - 책에서는 부가적인 설명을 더 하고 있는데, 조금 쉽게 풀어서 써보면 아래와 같다.  (번역이라서, 원본을 해치지 않으며 해석하려다 보니 책 내용이 조금 부자연스러웠나보다.)    
> - REST API 의 루트 리소스 후보에는 docroot가 포함될 수 있다. 이 docroot 라는 것은 http://api.soccer.restapi.org 와 같은 최상단의 REST API 진입점을 의미한다.



## 컬렉션

서버에서 관리하는 디렉터리를 위미하는 리소스를 표현한다. 서버 개발을 하는 입장이라면, 당연히 컬렉션이라는 것은 복수개의 데이터를 가진 하나의 테이블과 같은 개념으로 연상시키게 되는 것 같다.  

이 컬렉션을 표현할 때에는 복수 명사형으로 표현해야 한다. (**참고: 2.6 URI 경로 디자인**)  

컬렉션은 아래에 여러개의 도큐먼트가 포함될 수 있고, 예를 들어보면 디렉터리 아래에 여러개의 도큐먼트가 포함되어 있는 것을 연상하면 기억에 수월할 것 같다.  

아래의 예제들은 모두 컬렉션 리소스를 의미한다.  

- http://api.soccer.restapi.org/leagues
- http://api.soccer.restapi.org/leagues/seattle/teams
- http://api.soccer.restapi.org/leagues/seattle/teams/trebuchet/players

  

컬렉션에는 리소스 들을 제안할 수 있다. 클라이언트 측에서는 새로운 리소스(seattle, miami, newyork, ...) 들을 제안해서 컬렉션에 추가할 수 있다.  

하지만 새로운 리소스를 생성하는 것을 최종적으로 결정하는 것은 컬렉션에 달려있다.  

  

## 스토어

스토어는 클라이언트에서 관리하는 저장소이다. 스토어 스스로 새로운 리소스를 생성하지는 못한다. **리소스는 스토어에 처음 저장될 때 클라이언트가 선택한 URI를 가진다.** 라고 책에서는 설명하고 있다.  

이 부분이 조금 애매하고 추상적이다. 직접 이해한 내용을 정리해보면 이렇다. 

- 스토어 스스로는 새로운 리소스를 생성하지 못한다.
- 클라이언트에서 스토어를 관리하기 위해 REST API 를 만들어 스토어를 관리하기 시작했다.
- 스토어에 저장되는 리소스는 이 때 사용하는 REST API에 하나 하나 대응되어야 한다는 의미는 "리소스가 스토어에 대한 REST API에 대응된다"라는 의미와 같다.

  

아래 예제는 favorites 라는 스토어에 alonso 라는 도큐먼트 리소스를 추가하는 예 이다.

- PUT /users/1234/favorites/alonso



## 컨트롤러

컨트롤러 리소스는 실행 가능한 함수에 대응되는 리소스이다. 따라서 파라미터, 반환값이 있다.  

일반적인 CRUD와 의미상으로 맞아 떨어지지 않는 개념일 때, 또는 다른 동작일 때 (예를 들면 다른 API에 호출해서 질의 결과값을 가져오거나, 고객에게 메일을 보내는 연산을 수행하는 등) 표현되는 리소스를 컨트롤러 라고 한다.  

쉽게 요약하자면, 아래와 같은 경우에는 CRUD 를 위한 HTTP 메서드에 대응되지 않는다. 아래와 같은 경우에 대해 POST 메서드로 동작을 기술한다.

- 메일을 보내거나
- 다른 API 에 질의를 해서 결과값을 가져오는등 (OAuth 인증, 외부 API 조회 등)

  

컨트롤러를 REST API 에 표현하는 기본적인 원칙은 아래와 같다.

- 컨트롤러의 이름은 URI 경로의 제일 마지막에 표시하는 것이 원칙이다.
- 계층적으로 뒤따르는 자식 리소스는 없다.

  

아래 예제는 클라이언트가 사용자에게 경고를 전송하는 컨트롤러 리소스의 예이다.

- POST /alerts/245743/resend

