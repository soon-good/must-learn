# 스프링 카프카 프로듀서 컨슈머



## 프로듀서



## 컨슈머

카프카 클라이언트 라이브러리로 컨슈머를 직접 구현할 때 가장 어려운 부분은 커밋을 구현하는 부분이다. 카프카 컨슈머에서 직접 커밋을 구현할 때는 오토 커밋, 동기 커밋, 비동기 커밋으로 크게 세가지로 나뉘어진다. 하지만, 실제 운영환경에서는 다양한 종류의 커밋을 구현해서 사용해야 한다. 예를 들면 특정 타이밍마다 커밋을 하거나 레코드 갯수에 따라 커밋을 하는 규칙을 적용할 때는 로직을 새로 작성해야 한다.<br>

스프링 카프카는 사용자가 사용할 만한 커밋의 종류를 7가지로 세분화하고 미리 로직을 만들어놓았다. 사용자는 각 커밋 종류를 살펴보고 어떤 커밋 방식을 사용할지 정하면 된다. 스프링 카프카에서는 커밋이라는 용어를 `AckMode` 라고 부른다. 이 점에 유의해야 한다.<br>

프로듀서에서 사용하는 옵션 `acks` 과 컨슈머가 사용하는 옵션인 `AckMode` 는 둘 다 Acknowledgement 를 연상시키기에 혼동하기 쉽다. 프로듀서에서 사용하는 `acks` 와 컨슈머에서 사용하는 `AckMode` 는 명백히 다른 옵션이어서 `acks` 와 `AckMode` 를 혼동하지 않아야 한다. 스프링 카프카 컨슈머의 `AckMode` 의 기본 설정 값은 `BATCH` 다. 컨슈머의 `enable.auto.commit` 옵션의 기본 값은 false 로 지정된다.





| AckMode         | 용도 및 역할, 기본값                                         |
| --------------- | ------------------------------------------------------------ |
| RECORD          | 레코드 단위로 처리(프로세싱) 후 커밋                         |
| BATCH           | poll() 메서드로 호출된 레코드가 모두 처리된 이후에 커밋. 스프링 카프카 컨슈머의 AckMode 기본값 |
| TIME            | 특정 시간 이후에 커밋. 이 옵션을 사용할 경우, 시간 간격을 의미하는 AckTime 옵션을 지정해야 함 |
| COUNT           | 특정 갯수만큼 레코드가 처리된 이후에 커밋. 이 옵션을 사용할 경우, 레코드 갯수를 선언하는 AckCount 옵션을 지정해야 함 |
| COUNT_TIME      | TIME, COUNT 옵션 중 맞는 조건이 둘중에 하나라도 있을 경우 커밋을 수행 |
| MANUAL          | Acknowledgement.acknowledge() 메서드가 호출되면 다음번 poll() 에서 커밋을 한다. 매번 acknowledge() 메서드를 호출하면 BATCH 옵션과 동일하게 동작한다. 이 옵션을 사용할 경우 AcknowledgingMessageListener 또는 BatchAcknowledgingMessageListener 를 리스너로 사용해야 한다. |
| MANUAL_IMMEDATE | Acknwledgement.acknowledge() 메서드를 호출한 즉시 커밋한다. 이 옵션을 사용할 경우 AcknowledgingMessageListener 또는 BatchAcknowledgingMessageListener 를 리스너로 사용해야 한다. |

